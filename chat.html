<script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCzCmT5G243E0PCHCJ0mO3SWYVUBX0Jejo",
        authDomain: "ancient-r.firebaseapp.com",
        databaseURL: "https://ancient-r-default-rtdb.firebaseio.com/",
        projectId: "ancient-r",
        storageBucket: "ancient-r.appspot.com",
        messagingSenderId: "56153710356",
        appId: "1:56153710356:web:4ae289b63cf71c63312c01"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Get the username from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const username = urlParams.get('username') || 'Anonymous';
    document.getElementById('username-display').textContent = `Welcome, ${username}!`;

    // Send message to Firebase
    function sendMessage() {
        const messageInput = document.getElementById('message-input');
        const message = messageInput.value.trim();
        if (message === '') return;

        const messagesRef = ref(db, 'messages');
        push(messagesRef, {
            username: username,
            message: message,
            timestamp: Date.now()
        });

        messageInput.value = '';
    }

    // Listen for new messages
    const messagesRef = ref(db, 'messages');
    onChildAdded(messagesRef, (snapshot) => {
        const data = snapshot.val();
        const chatBox = document.getElementById('chat-box');
        const messageElement = document.createElement('div');
        messageElement.classList.add('message');
        messageElement.textContent = `${data.username}: ${data.message}`;
        chatBox.appendChild(messageElement);
        chatBox.scrollTop = chatBox.scrollHeight;
    });
</script>